<!DOCTYPE html>
<html lang="az">
<head>
  {% load static %}
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{% block title %}My Blog{% endblock %}</title>
  <link rel="stylesheet" href="{% static 'blog/styles.css' %}">
</head>
<body>
  <div class="container">
    <header class="header">
      <a href="/" class="brand">
        <span class="brand-logo" aria-hidden="true">
          <img src="https://i.pinimg.com/736x/00/7a/70/007a70e85bc1f051cc3120111f6b5f09.jpg" alt="" class="brand-logo-img" />
        </span>
        <h1>My Blog</h1>
      </a>
      <nav class="nav" aria-label="Primary">
        <form action="/" method="get" class="search">
          <input type="search" name="q" placeholder="Axtar..." aria-label="Search" />
        </form>
        <button class="btn secondary" id="theme-toggle" type="button" aria-label="Toggle theme">ðŸŒ™</button>
        <a href="/" class="nav-link">Posts</a>
        <a href="/profile/" class="nav-link">Profile</a>
        {% if request.user.is_authenticated %}
          <a href="/post/new/" class="nav-link">New Post</a>
        {% endif %}
        <a href="/admin/" class="nav-link">Admin</a>
      </nav>
    </header>
    <main>
      {% block content %}{% endblock %}
    </main>
    <footer class="footer">
      <div> 2025 My Blog Â· Built with Django</div>
    </footer>
  </div>
  <script src="{% static 'blog/app.js' %}"></script>
  <script>
    (function(){
      function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
      }
      const chatToggle = document.getElementById('chat-toggle');
      const chatWidget = document.getElementById('chat-widget');
      const chatClose = document.getElementById('chat-close');
      const chatForm = document.getElementById('chat-form');
      const chatInput = document.getElementById('chat-input');
      const chatMessages = document.getElementById('chat-messages');
      function showChat(){ if(!chatWidget) return; chatWidget.style.display='flex'; chatInput && chatInput.focus(); }
      function hideChat(){ if(!chatWidget) return; chatWidget.style.display='none'; }
      chatToggle && chatToggle.addEventListener('click', showChat);
      chatClose && chatClose.addEventListener('click', hideChat);
      function appendBubble(text, who){ if(!chatMessages) return; const row = document.createElement('div'); row.className = 'chat-row ' + who; const b = document.createElement('div'); b.className = 'bubble ' + who; b.textContent = text; row.appendChild(b); chatMessages.appendChild(row); chatMessages.scrollTop = chatMessages.scrollHeight; }
      chatForm && chatForm.addEventListener('submit', async function(e){
        e.preventDefault();
        const msg = (chatInput && chatInput.value || '').trim();
        if(!msg) return;
        appendBubble(msg, 'user');
        if (chatInput) chatInput.value = '';
        try {
          const res = await fetch('/chatbot/', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'X-Requested-With': 'XMLHttpRequest',
              'X-CSRFToken': getCookie('csrftoken') || ''
            },
            body: JSON.stringify({ message: msg })
          });
          if(!res.ok) throw new Error('Request failed');
          const data = await res.json();
          appendBubble(data.reply || 'Cavab yoxdur', 'bot');
        } catch(err){
          appendBubble('XÉ™ta baÅŸ verdi. Bir az sonra yenidÉ™n yoxlayÄ±n.', 'bot');
          console.error('chatbot failed', err);
        }
      });
    })();
  </script>
</body>
</html>
